<HTML>
	<HEAD>
		<style>
			BODY {
				/*background-image: url("https://i.stack.imgur.com/jGlzr.png");*/
				background-color	: #eae0ff;
			}
			.content::after{
				display		: block; 
			}
			.chip {
				width		: 100px;
				height		: 120px;
				border		: 2px solid black;
				display		: inline-block;
				font-size	: 30;
				text-align	: center;
			}
			.switchT {
				width		: 100px;
				height		: 120px;
				/*border		: 2px solid black;*/
				display		: inline-block;
				font-size	: 30;
				text-align	: center;
				position	: relative;
				right		: -40px;
				top		: -30px;
			}
			.switchL {
				width		: 100px;
				height		: 120px;
				/*border		: 2px solid black;*/
				display		: inline-block;
				font-size	: 30;
				text-align	: center;
				position	: relative;
				top		: 10px;
			}
			.switchD1 {
				width		: 100px;
				height		: 120px;
				/*border		: 2px solid black;*/
				display		: inline-block;
				font-size	: 30;
				text-align	: center;
				position	: relative;
				right		: -40px;
				top		: -30px;
			}
			.switchD2 {
				width		: 100px;
				height		: 120px;
				/*border		: 2px solid black;*/
				display		: inline-block;
				font-size	: 30;
				text-align	: center;
				position	: relative;
				right		: -40px;
				top		: -30px;
			}
			.side {
				width		: 110px;
				text-align	: center;
				float		: left;
			}
			.selected {
				/*background-image	: url("http://www.clker.com/cliparts/9/k/b/s/z/c/button-black-md.png");
 				background-position	: center;
				background-repeat	: no-repeat;
				background-size		: cover;
				background-color	: #ff99ff;*/
			}
			.wooden {
				background-image: url("https://i.stack.imgur.com/jGlzr.png");
			}
			.pink {
				background-color: #ff99ff;
			}
			.on {
				height		: 80px;
				width		: 80px;
				border-radius	: 50%;
				text-align	: center;
				vertical-align	: middle;
				font-size	: 500%;
				position	: relative;
				/*display: inline-block;*/
				margin		: 5%;
				/*box-shadow	: inset -10px -10px 100px #000, 
						  10px 10px 20px black, 
						  inset 0px 0px 10px black;*/
				background-color: yellow;
				top		: 15px;/*-78px;/*-9px;*/

			}
			.off {
				height		: 80px;
				width		: 80px;
				border-radius	: 50%;
				text-align	: center;
				vertical-align	: middle;
				font-size	: 500%;
				position	: relative;
				/*display: inline-block;*/
				margin		: 5%;
				/*box-shadow	: inset -10px -10px 100px #000, 
						  10px 10px 20px black, 
						  inset 0px 0px 10px black;*/
				background-color: black;
				top		: 15px;/*-78px;/*-9px;*/

			}
			.pick::after {
				background-color: rgba(255, 255, 255, 0.3);
				content		: '';
				height		: 45%;
				width		: 12%;
				position	: absolute;
				top		: 4%;
				left		: 15%;
				border-radius	: 50%;
				transform	: rotate(40deg);
			}

			.buttonT {
				height		: 50px;
				width		: 0px;
				background-color: #3bb3e0;
				font-family	: 'Open Sans', sans-serif;
				font-size	: 12px;
				text-decoration	: none;
				color		: #fff;
				position	: relative;
				padding		: 10px 20px;
				padding-right	: 20px;
				background-image: linear-gradient(bottom, rgb(44,160,202) 0%, rgb(62,184,229) 100%);
				border-radius	: 5px;
				box-shadow	: inset 0px 1px 0px #2ab7ec, 0px 5px 0px 0px #156785, 0px 10px 5px #999;
			}

			.buttonT:active {
				top		: 3px;
				background-image: linear-gradient(bottom, rgb(62,184,229) 0%, rgb(44,160,202) 100%);
				box-shadow	: inset 0px 1px 0px #2ab7ec, 0px 2px 0px 0px #156785, 0px 5px 3px #999;
			}

			.buttonT::before {
				background-color: #2591b4;
				background-image: url(down_arrow.png);
				background-repeat: no-repeat;
				background-position: center center;
				content		: "";
				width		: 20px;
				height		: 20px;
				position	: absolute;
				right		: 10px;
				top		: 70%;
				margin-top	: -9px;
				border-radius	: 50%;
				box-shadow	: inset 0px 1px 0px #052756, 0px 1px 0px #60c9f0;
			}

			.buttonT:active::before {
				top		: 70%;
				margin-top	: -12px;
				box-shadow	: inset 0px 1px 0px #60c9f0, 0px 3px 0px #0e3871, 0px 6px 3px #1a80a6;
			}



			.buttonL {
				height		: 20px;
				width		: 20px;
				background-color: #3bb3e0;
				font-family	: 'Open Sans', sans-serif;
				font-size	: 12px;
				text-decoration	: none;
				color		: #fff;
				position	: relative;
				padding		: 10px 20px;
				padding-right	: 50px;
				background-image: linear-gradient(bottom, rgb(44,160,202) 0%, rgb(62,184,229) 100%);
				border-radius	: 5px;
				box-shadow	: inset 0px 1px 0px #2ab7ec, 0px 5px 0px 0px #156785, 0px 10px 5px #999;
			}
			
			.buttonL:active {
				top		: 3px;
				background-image: linear-gradient(bottom, rgb(62,184,229) 0%, rgb(44,160,202) 100%);
				box-shadow	: inset 0px 1px 0px #2ab7ec, 0px 2px 0px 0px #156785, 0px 5px 3px #999;
			}

			.buttonL::before {
				background-color: #2591b4;
				background-image: url(right_arrow.png);
				background-repeat: no-repeat;
				background-position: center center;
				content		: "";
				width		: 20px;
				height		: 20px;
				position	: absolute;
				right		: 15px;
				top		: 50%;
				margin-top	: -9px;
				border-radius	: 50%;
				box-shadow	: inset 0px 1px 0px #052756, 0px 1px 0px #60c9f0;
			}
			
			.buttonL:active::before {
				top		: 50%;
				margin-top	:-12px;
				box-shadow	: inset 0px 1px 0px #60c9f0, 0px 3px 0px #0e3871, 0px 6px 3px #1a80a6;
			}
			.buttonD1 {
				height		: 30px;
				width		: 0px;
				background-color: #3bb3e0;
				font-family	: 'Open Sans', sans-serif;
				font-size	: 12px;
				text-decoration	: none;
				color		: #fff;
				position	: relative;
				padding		: 10px 20px;
				padding-right	: 30px;
				background-image: linear-gradient(bottom, rgb(44,160,202) 0%, rgb(62,184,229) 100%);
				border-radius	: 5px;
				box-shadow	: inset 0px 1px 0px #2ab7ec, 0px 5px 0px 0px #156785, 0px 10px 5px #999;
			}
			.buttonD1:active {
				top		: 3px;
				background-image: linear-gradient(bottom, rgb(62,184,229) 0%, rgb(44,160,202) 100%);
				box-shadow	: inset 0px 1px 0px #2ab7ec, 0px 2px 0px 0px #156785, 0px 5px 3px #999;
			}
			.buttonD1::before {
				background-color: #2591b4;
				background-image: url(right_arrow.png);
				background-repeat: no-repeat;
				background-position: center center;
				content		: "";
				width		: 20px;
				height		: 20px;
				position	: absolute;
				right		: 15px;
				top		: 50%;
				margin-top	: -9px;
				border-radius	: 50%;
				box-shadow	: inset 0px 1px 0px #052756, 0px 1px 0px #60c9f0;
			}			
			.buttonD1:active::before {
				top		: 50%;
				margin-top	:-12px;
				box-shadow	: inset 0px 1px 0px #60c9f0, 0px 3px 0px #0e3871, 0px 6px 3px #1a80a6;
			}
			.buttonD2 {
				height		: 30px;
				width		: 0px;
				background-color: #3bb3e0;
				font-family	: 'Open Sans', sans-serif;
				font-size	: 12px;
				text-decoration	: none;
				color		: #fff;
				position	: relative;
				padding		: 10px 20px;
				padding-right	: 30px;
				background-image: linear-gradient(bottom, rgb(44,160,202) 0%, rgb(62,184,229) 100%);
				border-radius	: 5px;
				box-shadow	: inset 0px 1px 0px #2ab7ec, 0px 5px 0px 0px #156785, 0px 10px 5px #999;
			}
			.buttonD2:active {
				top		: 3px;
				background-image: linear-gradient(bottom, rgb(62,184,229) 0%, rgb(44,160,202) 100%);
				box-shadow	: inset 0px 1px 0px #2ab7ec, 0px 2px 0px 0px #156785, 0px 5px 3px #999;
			}
			.buttonD2::before {
				background-color: #2591b4;
				background-image: url(right_arrow.png);
				background-repeat: no-repeat;
				background-position: center center;
				content		: "";
				width		: 20px;
				height		: 20px;
				position	: absolute;
				right		: 15px;
				top		: 50%;
				margin-top	: -9px;
				border-radius	: 50%;
				box-shadow	: inset 0px 1px 0px #052756, 0px 1px 0px #60c9f0;
			}			
			.buttonD2:active::before {
				top		: 50%;
				margin-top	:-12px;
				box-shadow	: inset 0px 1px 0px #60c9f0, 0px 3px 0px #0e3871, 0px 6px 3px #1a80a6;
			}
			
			ht { 
				/*display: block;*/
				font-size	: 2em;
				margin-top	: 0.68em;
				margin-bottom	: 0.67em;
				margin-left	: 0;
				margin-right	: 0;
				font-weight	: bold;
				}			
			tab {	padding-left	: 10em;}


		</style>
	</HEAD>
	<BODY>
		<div>
			<div style="float:left">
				1. 請輸入棋盤大小（<label>N= </label><input id='N' value=5 maxlength="2" size="1"/>）後按下
				<input type='submit' value='New Game' onclick='new_game()' />
				確定棋盤。<br>
				2. 請隨意點選棋子，設置初始狀態。<br>
				3. 按下
				<input type='submit' value='Start Game' onclick='start_game()' />
				後開始遊戲。 <br>
				4. 當棋子全亮時贏得遊戲！還有<input id='remain' value="" size="1" readonly />個
			</div>
			<div id='player' style="float:left"></div>
		</div>


		<div style="clear:both">
			<!--<div id='operator_d' class='side'> &nbsp;</div>-->
			<div id='operator_t' style="float:left">1</div>
		</div>
		<br>
		<div style="clear:both">
		<div id='operator_l' class='side'>
			<div class='chip'>1</div>
			<div class='chip selected'>2</div>
		</div>
		<div id='board' style="float:left">
			<div class='chip'>1</div>
			<div class='chip selected'>2</div>
		</div>
		</div>

		<br>



		<script>
			const query_string = new URLSearchParams(window.location.search);
			const N = query_string.get('N') || '5';
			document.getElementById('N').value = N;

			var start=1;
			var end=0;
			var remain=N*N;

			var chips = ``;
			for (var i = 1; i <= parseInt(N); ++i) {
				for (var j = 1; j <= parseInt(N); ++j) {
				chips += `<div id='i_${i}_${j}' class='chip wooden' onclick='selected(this)'>
					  	<div id='LB_${i}_${j}' class='off'></div>
					  </div>`;
				/*(${i},${j})<br><br><br>*/
				}
				chips += `<br>`
			}
			document.getElementById('board').innerHTML = chips;

			var switchs_t = ``;
			switchs_t += `<div id='i_d1' class='switchD1' onclick='clicked_d1(this)'><br><br>
					  	<div id='Sd1' class='buttonD1'></div>
					  </div>`;
			for (var i = 1; i <= parseInt(N); ++i) {
				switchs_t += `<div id='i_t_${i}' class='switchT' onclick='clicked_t(this)'><br><br>
					  	<div id='St_${i}' class='buttonT'></div>
					  </div>`;
			}
			switchs_t += `<div id='i_d2' class='switchD2' onclick='clicked_d2(this)'><br><br>
					  	<div id='Sd2' class='buttonD2'></div>
					  </div>`;
			document.getElementById('operator_t').innerHTML = switchs_t;

			var switchs_l = ``;
			for (var i = 1; i <= parseInt(N); ++i) {
				switchs_l += `<div id='i_l_${i}' class='switchL' onclick='clicked_l(this)'><br>
					  	<div id='Sl_${i}' class='buttonL'></div>
					  </div>`;
			}
			document.getElementById('operator_l').innerHTML = switchs_l;;

			var action_list = new Array();

			function selected( dom ) {
				var nrI = getI(dom.id);
				var nrJ = getJ(dom.id);
				if( start==1 && end != 1 ) {
					dom.classList.toggle('selected');
					bulbStatus(nrI,nrJ);
					/*console.log( dom );
					console.log( dom.id );
					console.log( nrI );
					console.log( nrJ );
					console.log( start );
					console.log( remain );*/
				} 
			}
			function clicked_t( dom ) {
				var nrI = getI(dom.id);
				var nrJ = getJ(dom.id);
				if( start==0 && end != 1 ) {
					for (var i = 1; i <= parseInt(N); ++i) {
						bulbStatus(i,nrJ);
					}
				} 
			}
			function clicked_l( dom ) {
				var nrI = getI(dom.id);
				var nrJ = getJ(dom.id);
				if( start==0 && end != 1 ) {
					for (var j = 1; j <= parseInt(N); ++j) {
						bulbStatus(nrJ,j);
					}
				} 
			}
			function clicked_d1( dom ) {
				if( start==0 && end != 1 ) {
					for (var j = 1; j <= parseInt(N); ++j) {
						bulbStatus(j,j);
					}
				} 
			}
			function clicked_d2( dom ) {
				if( start==0 && end != 1 ) {
					for (var j = 1; j <= parseInt(N); ++j) {
						bulbStatus(parseInt(N)-j+1,j);
					}
				} 
			}
			function bulbStatus(i,j){
				document.getElementById('LB_' + i + '_' + j).classList.toggle('on');
				document.getElementById('LB_' + i + '_' + j).classList.toggle('off');
				if (document.getElementById('LB_' + i + '_' + j).classList.contains('on')){
					remain=remain-1;
					document.getElementById('remain').value = remain ;
					console.log( remain );
				}
				if (document.getElementById('LB_' + i + '_' + j).classList.contains('off')){
					remain=remain+1;
					document.getElementById('remain').value = remain ;
					console.log( remain );
				}
				win();
			}
			function extractWord(str, char, pos)
			{
				if(pos=='b')
					return str.substr(0, str.indexOf(char));
				else if(pos=='a') 
				 	return str.substring(str.indexOf(char)+1);
				else
					return str;  
			}
			function getI(str){
				/*console.log(str);
				console.log(extractWord(str, '_','a'),'_','b');
				console.log(extractWord(extractWord(str, '_','a'),'_','b'));*/
				return extractWord(extractWord(str, '_','a'),'_','b');
			}
			function getJ(str){
				/*console.log(str);
				console.log(extractWord(str, '_','a'),'_','a');
				console.log(extractWord(extractWord(str, '_','a'),'_','a'));*/
				return extractWord(extractWord(str, '_','a'),'_','a');
			}
			function win() {
				if ( remain==0 ){
					/*document.getElementById('player').innerHTML = 
					`<div style='color:red; font-size:36pt' >Congrats! You win!!! </div>`;
					end=1;*/
				}
			}
			function start_game() {
				start=0;
			}
			function new_game() {
				var N = document.getElementById('N').value;

				window.location = '?N=' + N ;
				end=0;
			}

		</script>
	</BODY>
</HTML>
